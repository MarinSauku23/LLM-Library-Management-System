{% include "header.html" %}

<header class="masthead">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="site-heading">
          <h1>Library Insights</h1>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="container px-4 px-lg-5 my-5">
  <div class="row gx-4 gx-lg-5 justify-content-center">
    <div class="col-md-10 col-lg-8 col-xl-10">

      <form method="get" class="mb-4">
        <label class="form-label"><strong>View insights for:</strong></label>
        <select name="user_id" class="form-select" onchange="this.form.submit()">
          <option value="" {% if not selected_user_id %}selected{% endif %}>Whole library</option>
          {% for u in users %}
            <option value="{{ u.id }}" {% if selected_user_id == u.id %}selected{% endif %}>
              {{ u.name }} ({{ u.email }})
            </option>
          {% endfor %}
        </select>
      </form>

      <div class="card mb-4">
        <div class="card-body">
          <div style="white-space: pre-wrap;">{{ summary }}</div>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h6 class="card-title">Raw Metrics</h6>
          <pre style="margin:0; white-space: pre-wrap;">{{ metrics | tojson(indent=2) }}</pre>
        </div>
      </div>

    </div>
  </div>
</div>

{% include "footer.html" %}